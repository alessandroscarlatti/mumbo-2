var MessageBus=function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r){let t=0;e.exports=class{constructor(){this._functionPointerLib={},this._functionPointerCounter=0,this._createProxySubscriber(),this._id="MessageBus@"+t,t++}set send(e){this._send=e}set subscriber(e){this._objSubscriber=e}_createProxySubscriber(){const e={get:(e,r)=>{if(null!=this._functionPointerLib[r])return this._functionPointerLib[r];if(null!=this._objSubscriber)return this._objSubscriber[r];throw new Error("Cannot find property "+r+" on subscriber.")}};this._proxySubscriber=new Proxy({},e)}get publisher(){if(null==this._proxyPublisher){const e=this,r={get:function(r,t){return function(){let r=e._dehydrateArgs(arguments),n={type:"function",name:t,args:r},o=JSON.stringify(n);e._send(o)}}};this._proxyPublisher=new Proxy({},r)}return this._proxyPublisher}receive(e){console.log(this._id+" received message",e);let r=JSON.parse(e);const t=this._hydrateArgs(r.args,{});try{this._proxySubscriber[r.name](...t)}catch(e){console.log(e)}}_hydrateArgs(e,r){let t=[];return e.forEach(e=>{var r=this._hydrateArg(e);t.push(r)}),t}_hydrateArg(e){const r=this;switch(e.type){case"function":return function(){let t=r._dehydrateArgs(arguments),n={type:"function",name:e.name,args:t},o=JSON.stringify(n);r._send(o)};case"string":return String(e.value);case"number":return Number(e.value);case"boolean":return Boolean(e.value);case"json":return JSON.parse(e.value);case"object":let t={};for(let r in e.properties)e.properties.hasOwnProperty(r)&&(t[r]=this._hydrateArg(e.properties[r]));return t;case"array":let n=[];return e.elements.forEach(e=>{n.push(this._hydrateArg(e))}),n;default:throw new Error("Unhandled argument type: "+e.type)}}_dehydrateArgs(e){let r=[];for(let t=0;t<e.length;t++){let n=e[t],o=this._dehydrateArg(n);r.push(o)}return r}_dehydrateArg(e){if("string"==typeof e)return{type:"string",value:String(e)};if("function"==typeof e){let r="f@"+this._functionPointerCounter;return this._functionPointerCounter++,this._functionPointerLib[r]=e,{type:"function",name:r}}if("number"==typeof e)return{type:"number",value:e};if("boolean"==typeof e)return{type:"boolean",value:e};if("object"==typeof e){if("Array"===e.constructor.name){let r={type:"array",elements:[]};return e.forEach(e=>{r.elements.push(this._dehydrateArg(e))}),r}{let r={type:"object",properties:{}};for(let t in e)e.hasOwnProperty(t)&&(r.properties[t]=this._dehydrateArg(e[t]));return r}}throw new Error("Unsupported argument type for arg: "+e)}}}]);